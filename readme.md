# shoshinge-app

このリポジトリは「正信偈」や和讃の音声再生・表示を行うWebアプリの開発プロジェクトです。

## 概要
- 正信偈や和讃のテキスト表示
- 音声ファイル（mp3/m4a）の再生機能
- HTMLファイルによるUI試作
- 開発途中のため、機能や構成は今後変更される可能性があります

## ディレクトリ構成
- `audio/` : 音声ファイル（shoshinge.m4a, nenbutuwasan.mp3 など）
- 各種HTMLファイル : UIやロジックの試作

## 今後の予定
- UIの改善
- 音声再生機能の拡充
- 振り仮名表示や句長調整などの機能追加

## 注意事項
- 本プロジェクトは現在開発途中です。仕様やファイル構成は予告なく変更される場合があります。


## メインHTMLファイルの構造説明

### shoshinge_prototype.html 構造説明

#### 1. 概要
- 正信偈・念仏和讃のテキスト表示と音声再生ができるWebアプリです。
- ルビ（ふりがな）表示、句ごとのハイライト、音声と連動した表示切替が特徴です。
- **2025/08/27更新**: ページ高さ固定、句束中央寄せ、余白削減の UI/UX改善を実装
# shoshinge-app

正信偈と念仏和讃を、音声と同期して縦書き表示・ハイライトするWebアプリです。GitHub Pagesで公開しています。

- 公開URL: https://lyphard1.github.io/shoshinge-app/

## 使い方（編集・公開フロー）

1) 編集するファイル（docs配下を正とする）
- UI/スタイル: `docs/index.html`
- ロジック: `docs/script.js`
- 音声: `docs/audio/`
- 画像: `docs/image/`

2) ローカル確認
- VS Code の Live Server などで `docs/index.html` を開く
- もしくはブラウザでファイルを直接開いても可（機能はJSのみで動作）

3) 公開（デプロイ）
- 本リポジトリは GitHub Pages の「docs」モード（mainブランチの `docs/`）で公開しています
- 変更を `main` に push すると数分で自動反映されます
- 反映直後はキャッシュに注意（Ctrl+F5 や `?v=now` などで更新）

## リポジトリ構成（要点）

```
shoshinge-app/
├─ docs/                 # 公開用サイトのルート
│  ├─ index.html         # 画面・スタイル
│  ├─ script.js          # すべてのロジック（再生/ハイライト/画像切替 等）
│  ├─ audio/             # 公開用の音声ファイル
│  └─ image/             # 公開用の画像ファイル
├─ backup/               # 旧プロトタイプ等の退避
├─ docs_memo/            # メモ類（公開サイトとは無関係）
├─ readme.md             # このファイル
└─ 正信偈アプリの資料.md  # 設計メモ（プロトタイプ期含む）
```

## 開発ルール（重要）

- 編集は `docs/` 配下に限定（公開物と差異を作らない）
- index.html にインライン `<script>` を置かず、`docs/script.js` に一本化
- アセット（音声/画像）は `docs/` 配下に置く
- パスは `docs/` 起点の相対パス（例: `audio/shoshinge.mp3`, `image/帰命無量寿如来.png`）
	- Project Pagesでは `/...` で始まる絶対パスはNG（リポジトリ名のプレフィックスが必要になるため）
- ルビのベース要素は `<rb>` ではなく `span.rb` を使用（ブラウザ互換のため）
- コミットメッセージは日本語推奨

## 機能概要

- 正信偈/念仏和讃のモード切替（アクティブ＝青、非アクティブ＝白っぽい）
- 音声再生・一時停止・シーク（プログレスバークリック）
- 句ハイライト＋文字単位ハイライト（青色）
- ページに対応した画像切替
- 縦書きレイアウト（writing-mode: vertical-rl; text-orientation: upright）

## トラブルシュート

- 404（音声/画像）
	- `docs/` 外のファイルを参照していないか確認
	- ルート絶対パス（`/audio/...` 等）を使わず相対パスに統一
	- `.gitignore` で `docs/audio` が無視されていないか確認
- スクリプトエラー（再宣言など）
	- インライン `<script>` と外部 `script.js` の二重定義を排除
- 反映されない
	- キャッシュを強制更新（Ctrl+F5 / `?v=timestamp`）

- Live Server で音声が再生できない（エラーコード: 4）
	- `docs/script.js` の音声パスが絶対パス `/...` になっていないか確認し、`audio/shoshinge.mp3` のように相対パスへ修正
	- 必ず `docs/index.html` を Live Server で開く（file:// 直開きは不可）。Live Server のルートが `docs/` でない場合は 404 になります
	- ブラウザの Network タブで音声リクエスト URL が 200 か確認（404/302 ならパス/ルート設定の問題）

## パフォーマンス最適化（初期ロード）

- 音声のプリロード最適化
	- `audio.preload = 'metadata'` を設定。初期表示ではメタデータのみ取得し、再生開始時に本体を取得して初回表示の通信量を抑制
- 画像のロード方針
	- 初期に読み込むのは表示中の1枚のみ。全画像の一括プリロードは行っていません（ページ遷移に応じて1枚ずつロード）
- 体感がまだ重い場合の追加案（未適用）
	- `<img loading="lazy">` の付与、画像の WebP/JPEG 最適化、ページDOMのオンデマンド生成（必要時に次ページ構築）

## 更新履歴（抜粋）

- 2025-08-28
	- 文字単位ハイライトを復旧（span.rb + 青色文字）
	- モード切替ボタンのアクティブ/非アクティブ配色を整理
	- インラインスクリプト廃止、`docs/script.js` に統一
	- GitHub Pages 向けのパス/アセット配置を確立
	- Live Server 向けに音声パスを相対化（絶対パスに起因する 404/エラーコード4 を解消）
	- 初期ロード軽量化のため `audio.preload = 'metadata'` を設定
- 2025-08-27
	- 縦書きUIの調整、見栄え改善

## ライセンス

未定
