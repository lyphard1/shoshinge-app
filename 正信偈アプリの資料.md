# 正信偈アプリ プロジェクト資料

## 1. 概要

このプロジェクトは、「正信偈」および「念仏和讃」の音声とテキストを同期させて表示するWebアプリケーションです。主な機能として、音声の再生に合わせて対応する句がハイライトされ、関連する画像が表示されます。

## 2. プロジェクト構成

### 2.1. ファイル構成

```
shoshinge-app/
├── shoshinge_prototype.html  # メインのアプリケーションファイル
├── readme.md                 # プロジェクトの説明ファイル
├── 正信偈アプリの資料.md       # この資料ファイル
├── image/                    # 表示用画像フォルダ
│   ├── 帰命無量寿如来.png
│   └── ... (多数の画像ファイル)
└── audio/                    # 音声ファイルフォルダ
    ├── shoshinge.mp3
    └── nenbutuwasan.mp3
```

### 2.2. 主要ファイル

- **`shoshinge_prototype.html`**
  - アプリケーションのすべてのロジック（HTML, CSS, JavaScript）を含んでいます。
  - ユーザーインターフェースの定義、句のデータ、音声再生ロジック、画像切り替え機能などが記述されています。

- **`image/` フォルダ**
  - 正信偈および和讃の各ページに対応する画像が格納されています。
  - ファイル名は、表示される句の内容に関連付けられています。

- **`audio/` フォルダ**
  - 再生用の音声ファイル（MP3形式）が格納されています。

## 3. 主な機能と実装

### 3.1. モード切替
- 「正信偈」と「念仏和讃」の2つのモードをボタンで切り替えることができます。
- モードを切り替えると、対応する音声とテキスト、画像セットが読み込まれます。

### 3.2. 音声とテキストの同期
- JavaScript内の `originalPagesData` という配列に、各句のテキスト、ルビ（ふりがな）、および音声ファイル内での開始・終了時刻（タイムスタンプ）がページごとに定義されています。
- `audio` 要素の `timeupdate` イベントを利用して、現在の再生時刻を常に監視しています。
- 再生時刻が特定の句のタイムスタンプの範囲内にある場合、その句の `<div>` 要素に `.highlight` クラスを付与し、背景色を変更してハイライト表示します。

### 3.3. 画像表示
- JavaScript内の `imageFiles` というオブジェクトに、各モード（正信偈・和讃）で表示する画像のファイル名リストがページ順に定義されています。
- `highlightVerse` 関数内で、現在ハイライトされている句がどのページに属するかを判定し、そのページのインデックスに対応する画像を表示します。
- これにより、ページが切り替わるタイミングで画像も連動して更新されます。

### 3.4. ページ構成
- 句は縦書きで表示され、ページごとに定義された句数で1ページを構成します。
- 音声の進行に合わせて、アクティブなページが自動的に切り替わって表示されます。

## 4. 開発・実行環境

### 4.1. 実行方法
- VS Codeの拡張機能「Live Server」を利用して `shoshinge_prototype.html` を開くことで、ローカル環境でアプリケーションを動作させることができます。
  1. `shoshinge_prototype.html` をエディタで開く。
  2. 右クリックし、「Open with Live Server」を選択する。
  3. ブラウザが起動し、アプリケーションが表示されます。

### 4.2. 音声ファイルの変換
- `m4a` 形式の音声ファイルを `mp3` に変換する際は、`ffmpeg` を使用しました。
  ```sh
  # 例: m4a から mp3 への変換コマンド
  ffmpeg -i input.m4a -codec:a libmp3lame -qscale:a 3 output.mp3
  ```

## 5. 更新履歴

### 2025/08/25
- `shoshinge_prototype.html` の念仏和讃モードを修正
  - ページの構成を新しいレイアウトに変更。
  - 各ページに対応する画像表示を修正。
  - 画像切り替えロジックを、句ごとからページごとに変更。

